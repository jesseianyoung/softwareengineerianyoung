<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Monthsary Letter</title>
    <style>
        body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          max-width: 600px;
          margin: 30px auto;
          padding: 0 20px;
          background: #0b1a3d;
          color: #cce0ff;
          overflow-x: hidden;
        }

        @keyframes neonPulse {
          0%, 100% {
            background-position: center center;
            filter: brightness(1);
          }
          50% {
            background-position: center center;
            filter: brightness(1.4);
          }
        }

        @keyframes colorShift {
          0% {
            --color1: #6dd5fa;
            --color2: #2980b9;
          }
          50% {
            --color1: #fbc7a4;
            --color2: #e05d5d;
          }
          100% {
            --color1: #6dd5fa;
            --color2: #2980b9;
          }
        }

        @keyframes sparkle {
          0%, 100% { opacity: 0.2; transform: scale(1) translateY(0); }
          50% { opacity: 1; transform: scale(1.3) translateY(-5px); }
        }

        #countdownOverlay {
          position: fixed;
          top: 0; left: 0; right: 0; bottom: 0;
          background: radial-gradient(circle at center, var(--color1, #6dd5fa), var(--color2, #2980b9));
          animation: neonPulse 2.5s ease-in-out infinite, colorShift 5s linear infinite;
          color: #ffffff;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 7rem;
          font-weight: 900;
          user-select: none;
          z-index: 9999;
          opacity: 1;
          transition: opacity 1s ease;
          overflow: hidden;
        }

        .sparkle {
          position: absolute;
          width: 6px;
          height: 6px;
          background: white;
          border-radius: 50%;
          opacity: 0.3;
          animation: sparkle 3s ease-in-out infinite;
          filter: drop-shadow(0 0 4px #fff);
        }

        /* Each sparkle will get a random animation delay and position in JS */

        @keyframes scaleFade {
          0% {
            transform: scale(1);
            opacity: 1;
          }
          50% {
            transform: scale(1.5);
            opacity: 0.3;
          }
          100% {
            transform: scale(1);
            opacity: 1;
          }
        }

        @keyframes flickerGlow {
          0%, 100% {
            text-shadow:
              0 0 12px #ffffff,
              0 0 24px #a0c4ff,
              0 0 36px #79aaff,
              0 0 48px #4977d1,
              0 0 60px #79aaff;
          }
          50% {
            text-shadow:
              0 0 18px #c0dbff,
              0 0 36px #c0dbff,
              0 0 54px #a0c4ff,
              0 0 72px #6d94ff,
              0 0 90px #a0c4ff;
          }
        }

        .animate-number {
          animation: scaleFade 1s ease forwards, flickerGlow 1s ease infinite;
        }

        #mainContent {
          display: none;
          opacity: 0;
          transition: opacity 1s ease;
        }

        h1 {
          text-align: center;
          color: #79aaff;
        }
        .months {
          display: flex;
          justify-content: center;
          flex-wrap: wrap;
          gap: 8px;
          margin-bottom: 25px;
        }
        .month-btn {
          padding: 10px 15px;
          background-color: #1f3b7a;
          border: none;
          border-radius: 20px;
          cursor: pointer;
          font-weight: 600;
          color: #cce0ff;
          transition: background-color 0.3s ease;
          box-shadow: 0 2px 5px rgb(0 0 0 / 0.3);
        }
        .month-btn:hover {
          background-color: #4977d1;
          color: white;
        }
        .month-btn.active {
          background-color: #79aaff;
          color: #0b1a3d;
        }
        .letter-box {
          background: #162e6a;
          border-radius: 10px;
          padding: 20px;
          box-shadow: 0 2px 10px rgb(0 0 0 / 0.5);
          min-height: 150px;
          white-space: normal; /* changed from pre-wrap */
          font-size: 1.1rem;
          line-height: 1.5;
          color: #d0e1ff;
          overflow-wrap: break-word;
          word-break: break-word;
          /* Removed flex centering */
        }
    </style>
</head>
<body>

<div id="countdownOverlay">
    <span id="countdownNumber">5</span>
    <!-- sparkles generated by JS -->
</div>

<div id="mainContent">
    <h1>Our Monthsary Letters</h1>

    <div class="months" id="monthsContainer"></div>

    <div class="letter-box" id="letterBox">
        Select a month to see your special letter.
    </div>
</div>

<script>
    const countdownOverlay = document.getElementById('countdownOverlay');
    const countdownNumber = document.getElementById('countdownNumber');
    const mainContent = document.getElementById('mainContent');

    // Generate sparkles dynamically
    const sparkleCount = 15;

    for (let i = 0; i < sparkleCount; i++) {
      const sparkle = document.createElement('div');
      sparkle.classList.add('sparkle');

      // Random position inside viewport (percentage)
      sparkle.style.top = (Math.random() * 100) + '%';
      sparkle.style.left = (Math.random() * 100) + '%';

      // Random animation delay so sparkles twinkle at different times
      sparkle.style.animationDelay = (Math.random() * 3) + 's';

      // Slightly random size for more natural look
      const size = 4 + Math.random() * 6; // 4px to 10px
      sparkle.style.width = size + 'px';
      sparkle.style.height = size + 'px';

      countdownOverlay.appendChild(sparkle);
    }

    let count = 5;

    function animateNumber() {
      countdownNumber.textContent = count;
      countdownNumber.classList.remove('animate-number');
      void countdownNumber.offsetWidth; // restart animation
      countdownNumber.classList.add('animate-number');
    }

    const timer = setInterval(() => {
      animateNumber();
      count--;
      if (count < 0) {
        clearInterval(timer);
        countdownOverlay.style.opacity = '0';
        setTimeout(() => {
          mainContent.style.display = 'block';
          setTimeout(() => {
            mainContent.style.opacity = '1';
            countdownOverlay.style.display = 'none';
          }, 100);
        }, 1000);
      }
    }, 1000);

    const months = [
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];

    let letters = {};

    fetch('/api/letters')
      .then(response => response.json())
      .then(data => {
        letters = data;
        const monthsContainer = document.getElementById("monthsContainer");
        const letterBox = document.getElementById("letterBox");

        months.forEach(month => {
          const btn = document.createElement("button");
          btn.textContent = month;
          btn.classList.add("month-btn");
          btn.addEventListener("click", () => {
            document.querySelectorAll(".month-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            const content = letters[month] || "No letter for this month yet.";
            if (month === "August" && content.startsWith("/letters/")) {
    letterBox.innerHTML = `<iframe src="${content}" style="width:100%; height:400px; border:none; border-radius:8px;"></iframe>`;
  } else {
    letterBox.textContent = content; // safer to use textContent for plain text
  }

          });
          monthsContainer.appendChild(btn);
        });
      })
      .catch(err => {
        console.error("Failed to fetch letters:", err);
      });
</script>

</body>
</html>
